<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>RUN FIT - Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠØ© Ù…Ø¹ ÙˆØ¬Ø¨Ø§Øª Ø¬Ø§Ù‡Ø²Ø©</title>

<!-- Google Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
  body { margin: 0; font-family: "Cairo", sans-serif; direction: rtl; background: #f5f7fb; }
  .navbar { background: #0a7cff; padding: 18px 40px; color: white; display: flex; justify-content: space-between; font-size: 20px; font-weight: 700; }
  .navbar ul { display: flex; list-style: none; gap: 25px; }
  .navbar a { color: white; text-decoration: none; font-size: 18px; cursor: pointer; }
  .container { max-width: 700px; margin: 40px auto; background: white; padding: 30px; border-radius: 16px; box-shadow: 0 5px 18px rgba(0,0,0,0.12); }
  input, select { width: 100%; padding: 12px; border-radius: 10px; border: 1px solid #bbb; margin: 8px 0; }
  button { width: 100%; padding: 15px; background: #0a7cff; color: white; border: none; border-radius: 12px; font-size: 18px; cursor: pointer; margin-top: 10px; }
  .result-box { margin-top: 20px; background: #e9f4ff; border-right: 6px solid #008cff; padding: 20px; border-radius: 12px; }
  .history-box { margin-top: 20px; padding: 20px; background: #fff; border-radius: 12px; box-shadow: 0 3px 10px rgba(0,0,0,0.1); }
  footer { margin-top: 50px; background: #0a7cff; color: white; padding: 20px; text-align: center; }
  .hidden { display: none; }
</style>
</head>

<body>

<!-- NAVBAR -->
<nav class="navbar">
  <div>RUN FIT</div>
  <ul>
    <li><a onclick="showSection('calcSection')">Ø­Ø§Ø³Ø¨Ø© Ø§Ù„Ø¬Ø±ÙŠ</a></li>
    <li><a onclick="showSection('historySection')">Ø§Ù„Ø³Ø¬Ù„</a></li>
    <li><a onclick="showSection('dietSection')">Ø§Ù„Ø­Ù…ÙŠØ©</a></li>
    <li><a id="logoutBtn" class="hidden" onclick="logout()">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</a></li>
  </ul>
</nav>

<!-- LOGIN & REGISTER -->
<div class="container" id="authSection">
  <h2>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ / Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯</h2>

  <label>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ:</label>
  <input type="email" id="email">

  <label>ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±:</label>
  <input type="password" id="password">

  <button onclick="login()">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>
  <button onclick="register()">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯</button>

  <div id="authMsg" class="result-box"></div>
</div>

<!-- CALCULATOR -->
<div class="container hidden" id="calcSection">
  <h2>Ø­Ø§Ø³Ø¨Ø© Ø§Ù„Ø¬Ø±ÙŠ Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©</h2>

  <label>Ø§Ù„Ø¹Ù…Ø±:</label>
  <input type="number" id="age">

  <label>Ø§Ù„ÙˆØ²Ù† (ÙƒØº):</label>
  <input type="number" id="weight">

  <label>Ø§Ù„Ø·ÙˆÙ„ (Ø³Ù…):</label>
  <input type="number" id="height">

  <label>Ø§Ù„Ø¬Ù†Ø³:</label>
  <select id="gender">
    <option value="male">Ø°ÙƒØ±</option>
    <option value="female">Ø£Ù†Ø«Ù‰</option>
  </select>

  <label>Ø§Ù„Ø³Ø¹Ø±Ø§Øª Ø§Ù„Ù…Ø±Ø§Ø¯ Ø­Ø±Ù‚Ù‡Ø§:</label>
  <input type="number" id="cal">

  <label>Ø³Ø±Ø¹Ø© Ø§Ù„Ø¬Ø±ÙŠ (ÙƒÙ…/Ø³Ø§Ø¹Ø©):</label>
  <input type="number" id="speed">

  <button onclick="calculate()">Ø§Ø­Ø³Ø¨ Ø§Ù„Ø¢Ù†</button>

  <div id="result" class="result-box"></div>
</div>

<!-- HISTORY -->
<div class="container hidden" id="historySection">
  <h2>ğŸ“Œ Ø³Ø¬Ù„ ØªØ¯Ø±ÙŠØ¨Ø§ØªÙƒ</h2>

  <canvas id="chart" height="120"></canvas>

  <div id="historyBox" class="history-box"></div>
</div>

<!-- DIET -->
<div class="container hidden" id="dietSection">
  <h2>ğŸ¥— ØªØªØ¨Ø¹ Ø§Ù„Ø­Ù…ÙŠØ© Ø§Ù„ÙŠÙˆÙ…ÙŠØ©</h2>

  <label>Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„ÙˆØ¬Ø¨Ø©:</label>
  <select id="mealSelect">
    <option value="Ø¥ÙØ·Ø§Ø±" data-cal="300">Ø¥ÙØ·Ø§Ø± - 300 Ø³Ø¹Ø± Ø­Ø±Ø§Ø±ÙŠ</option>
    <option value="ØºØ¯Ø§Ø¡" data-cal="600">ØºØ¯Ø§Ø¡ - 600 Ø³Ø¹Ø± Ø­Ø±Ø§Ø±ÙŠ</option>
    <option value="Ø¹Ø´Ø§Ø¡" data-cal="500">Ø¹Ø´Ø§Ø¡ - 500 Ø³Ø¹Ø± Ø­Ø±Ø§Ø±ÙŠ</option>
    <option value="ÙˆØ¬Ø¨Ø© Ø®ÙÙŠÙØ©" data-cal="200">ÙˆØ¬Ø¨Ø© Ø®ÙÙŠÙØ© - 200 Ø³Ø¹Ø± Ø­Ø±Ø§Ø±ÙŠ</option>
  </select>

  <button onclick="addMeal()">Ø£Ø¶Ù Ø§Ù„ÙˆØ¬Ø¨Ø©</button>

  <div id="dietBox" class="history-box"></div>
  <div id="totalCalories" class="result-box"></div>
  <div id="calorieSummary" class="result-box"></div>
</div>

<footer>
  Â© 2025 RUN FIT â€” Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠØ©
</footer>

<script>
let currentUser = localStorage.getItem("currentUser") || null;
let users = JSON.parse(localStorage.getItem("users") || "{}");
let runHistory = [];
let dietHistory = [];
let chart;

// ------------------- ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø³Ø§Ø¨ -------------------
function register() {
  let email = document.getElementById("email").value.trim();
  let password = document.getElementById("password").value.trim();
  if(!email || !password) return alert("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¨Ø±ÙŠØ¯ ÙˆÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±");
  if(users[email]) return alert("Ù‡Ø°Ø§ Ø§Ù„Ø­Ø³Ø§Ø¨ Ù…ÙˆØ¬ÙˆØ¯ Ø¨Ø§Ù„ÙØ¹Ù„");
  users[email] = { password, runHistory: [], dietHistory: [] };
  localStorage.setItem("users", JSON.stringify(users));
  alert("ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø¨Ù†Ø¬Ø§Ø­! ÙŠÙ…ÙƒÙ†Ùƒ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø¢Ù†.");
}

function login() {
  let email = document.getElementById("email").value.trim();
  let password = document.getElementById("password").value.trim();
  if(users[email] && users[email].password === password) {
    currentUser = email;
    localStorage.setItem("currentUser", currentUser);
    showApp();
  } else alert("Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø£Ùˆ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©");
}

function logout() {
  currentUser = null;
  localStorage.removeItem("currentUser");
  document.getElementById("authSection").classList.remove("hidden");
  document.getElementById("calcSection").classList.add("hidden");
  document.getElementById("historySection").classList.add("hidden");
  document.getElementById("dietSection").classList.add("hidden");
  document.getElementById("logoutBtn").classList.add("hidden");
}

// ------------------- Ø¹Ø±Ø¶ Ø§Ù„Ø£Ù‚Ø³Ø§Ù… -------------------
function showApp() {
  document.getElementById("authSection").classList.add("hidden");
  document.getElementById("calcSection").classList.remove("hidden");
  document.getElementById("historySection").classList.remove("hidden");
  document.getElementById("dietSection").classList.remove("hidden");
  document.getElementById("logoutBtn").classList.remove("hidden");

  runHistory = users[currentUser].runHistory || [];
  dietHistory = users[currentUser].dietHistory || [];
  updateHistory();
  drawChart();
  updateDiet();
}

function showSection(id) {
  if(!currentUser) return alert("ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹");
  document.getElementById("calcSection").classList.add("hidden");
  document.getElementById("historySection").classList.add("hidden");
  document.getElementById("dietSection").classList.add("hidden");
  document.getElementById(id).classList.remove("hidden");
}

// ------------------- Ø­Ø§Ø³Ø¨Ø© Ø§Ù„Ø¬Ø±ÙŠ -------------------
function calculate() {
  if(!currentUser) return alert("ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹");
  let age = Number(document.getElementById("age").value);
  let weight = Number(document.getElementById("weight").value);
  let height = Number(document.getElementById("height").value);
  let gender = document.getElementById("gender").value;
  let calories = Number(document.getElementById("cal").value);
  let speed = Number(document.getElementById("speed").value);
  if (!age || !weight || !height || !calories || !speed) return alert("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ù…Ù„Ø¡ ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª");

  let pace = 60 / speed;
  let distance = calories / weight;
  let timeMinutes = (distance / speed) * 60;
  let vo2 = (speed * 3.5).toFixed(1);

  let entry = { distance: distance.toFixed(2), calories, speed, date: new Date().toLocaleString() };
  runHistory.push(entry);
  users[currentUser].runHistory = runHistory;
  localStorage.setItem("users", JSON.stringify(users));

  document.getElementById("result").innerHTML = `
    âœ” Ø§Ù„Ù…Ø³Ø§ÙØ© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©: <b>${distance.toFixed(2)} ÙƒÙ…</b><br>
    âœ” Ø§Ù„Ø²Ù…Ù† Ø§Ù„Ù…Ø·Ù„ÙˆØ¨: <b>${timeMinutes.toFixed(1)} Ø¯Ù‚ÙŠÙ‚Ø©</b><br>
    âœ” Ø§Ù„Ù€ Pace: <b>${pace.toFixed(2)} Ø¯Ù‚ÙŠÙ‚Ø©/ÙƒÙ…</b><br>
    âœ” VOâ‚‚ Max: <b>${vo2}</b><br>
    âœ” Ø§Ù„Ø³Ø¹Ø±Ø§Øª Ù„ÙƒÙ„ ÙƒÙŠÙ„ÙˆÙ…ØªØ±: <b>${weight}</b>
  `;

  updateHistory();
  drawChart();
  updateDiet();
}

// ------------------- Ø§Ù„Ø­Ù…ÙŠØ© -------------------
  function addMeal() {
  if(!currentUser) return alert("ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹");

  let select = document.getElementById("mealSelect");
  let meal = select.value;
  let cal = Number(select.options[select.selectedIndex].dataset.cal);

  let entry = { meal, calories: cal, date: new Date().toLocaleString() };
  dietHistory.push(entry);
  users[currentUser].dietHistory = dietHistory;
  localStorage.setItem("users", JSON.stringify(users));

  updateDiet();
}

function updateDiet() {
  let html = "", totalFood = 0;
  dietHistory.forEach(e => {
    html += `<p>ğŸ¥— ${e.meal}: <b>${e.calories} Ø³Ø¹Ø± Ø­Ø±Ø§Ø±ÙŠ</b> â€” ğŸ“… ${e.date}</p><hr>`;
    totalFood += e.calories;
  });
  document.getElementById("dietBox").innerHTML = html;
  document.getElementById("totalCalories").innerHTML = `<b>Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ø³Ø¹Ø±Ø§Øª Ø§Ù„ÙŠÙˆÙ…: ${totalFood} Ø³Ø¹Ø± Ø­Ø±Ø§Ø±ÙŠ</b>`;
  updateCalorieSummary(totalFood);
}

function updateCalorieSummary(totalFood) {
  let totalBurned = runHistory.reduce((sum,e)=>sum+e.calories,0);
  let remaining = totalFood - totalBurned;
  let msg = `ğŸ½ Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ø³Ø¹Ø±Ø§Øª Ø§Ù„Ù…Ø³ØªÙ‡Ù„ÙƒØ©: <b>${totalFood} Ø³Ø¹Ø± Ø­Ø±Ø§Ø±ÙŠ</b><br>
             ğŸƒ Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ø³Ø¹Ø±Ø§Øª Ø§Ù„Ù…Ø­Ø±ÙˆÙ‚Ø©: <b>${totalBurned} Ø³Ø¹Ø± Ø­Ø±Ø§Ø±ÙŠ</b><br>`;
  if(remaining > 0){
    msg += `âš  ØªØ­ØªØ§Ø¬ Ù„Ø­Ø±Ù‚ <b>${remaining} Ø³Ø¹Ø± Ø­Ø±Ø§Ø±ÙŠ</b> Ø¥Ø¶Ø§ÙÙŠØ© Ù„ØªØ­Ù‚ÙŠÙ‚ Ø§Ù„ØªÙˆØ§Ø²Ù† Ø§Ù„ÙŠÙˆÙ….`;
  } else {
    msg += `âœ… Ù„Ù‚Ø¯ ÙˆØµÙ„Øª Ù„Ù‡Ø¯ÙÙƒ Ø§Ù„ÙŠÙˆÙ… Ø£Ùˆ ØªØ¬Ø§ÙˆØ²ØªÙ‡!`;
  }
  document.getElementById("calorieSummary").innerHTML = msg;
}

// ------------------- Ø³Ø¬Ù„ Ø§Ù„Ø¬Ø±ÙŠ -------------------
function updateHistory() {
  let html = "";
  runHistory.forEach(e => {
    html += `<p>ğŸƒ Ù…Ø³Ø§ÙØ©: <b>${e.distance} ÙƒÙ…</b> â€” ğŸ”¥ Ø³Ø¹Ø±Ø§Øª: <b>${e.calories}</b> â€” âš¡ Ø³Ø±Ø¹Ø©: <b>${e.speed}</b> â€” ğŸ“… ${e.date}</p><hr>`;
  });
  document.getElementById("historyBox").innerHTML = html;
}

function drawChart() {
  let ctx = document.getElementById("chart");
  if(chart) chart.destroy();
  chart = new Chart(ctx, {
    type: "line",
    data: {
      labels: runHistory.map(e => e.date),
      datasets: [{ label: "Ø§Ù„Ù…Ø³Ø§ÙØ© (ÙƒÙ…)", data: runHistory.map(e => e.distance), borderWidth: 3 }]
    },
    options: { scales: { y: { beginAtZero: true } } }
  });
}

// ------------------- Ø§Ù„Ø­Ù…ÙŠØ© -------------------

// ------------------- Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø© -------------------
if(currentUser) showApp();
</script>

</body>
</html>
