<!-- DIET -->
<div class="container hidden" id="dietSection">
  <h2>๐ฅ ุชุชุจุน ุงูุญููุฉ ุงูููููุฉ</h2>

  <label>ุงุฎุชุฑ ุงููุฌุจุฉ:</label>
  <select id="mealSelect">
    <option value="ุฅูุทุงุฑ|300">ุฅูุทุงุฑ - 300 ุณุนุฑ ุญุฑุงุฑู</option>
    <option value="ุบุฏุงุก|600">ุบุฏุงุก - 600 ุณุนุฑ ุญุฑุงุฑู</option>
    <option value="ุนุดุงุก|500">ุนุดุงุก - 500 ุณุนุฑ ุญุฑุงุฑู</option>
    <option value="ูุฌุจุฉ ุฎูููุฉ|150">ูุฌุจุฉ ุฎูููุฉ - 150 ุณุนุฑ ุญุฑุงุฑู</option>
  </select>

  <button onclick="addMeal()">ุฃุถู ุงููุฌุจุฉ</button>

  <div id="dietBox" class="history-box"></div>
  <div id="totalCalories" class="result-box"></div>
</div>

<script>
// ุฅุถุงูุฉ ูุฌุจุฉ ูู ุงูุฎูุงุฑุงุช
function addMeal() {
  let selected = document.getElementById("mealSelect").value;
  let [meal, cal] = selected.split("|");
  cal = Number(cal);

  if(!meal || !cal) return alert("ุงูุฑุฌุงุก ุงุฎุชูุงุฑ ูุฌุจุฉ ุตุญูุญุฉ");

  let entry = { meal, calories: cal, date: new Date().toLocaleString() };
  dietHistory.push(entry);
  users[currentUser].dietHistory = dietHistory;
  localStorage.setItem("users", JSON.stringify(users));
  updateDiet();
}

// ุชุญุฏูุซ ูุงุฆูุฉ ุงูุญููุฉ ูุน ุฃุฒุฑุงุฑ ุชุนุฏูู ูุญุฐู
function updateDiet() {
  let html = "", total = 0;
  dietHistory.forEach((e, index) => {
    html += `
      <p>
        ๐ฅ ${e.meal}: <b>${e.calories} ุณุนุฑ ุญุฑุงุฑู</b> โ ๐ ${e.date}
        <button onclick="editMeal(${index})" style="margin-left:5px;">ุชุนุฏูู</button>
        <button onclick="deleteMeal(${index})" style="margin-left:5px;">ุญุฐู</button>
      </p><hr>`;
    total += e.calories;
  });
  document.getElementById("dietBox").innerHTML = html;
  document.getElementById("totalCalories").innerHTML = `<b>ูุฌููุน ุงูุณุนุฑุงุช ุงูููู: ${total} ุณุนุฑ ุญุฑุงุฑู</b>`;
}

// ุญุฐู ูุฌุจุฉ
function deleteMeal(index) {
  if(confirm("ูู ุชุฑูุฏ ุญุฐู ูุฐู ุงููุฌุจุฉุ")) {
    dietHistory.splice(index, 1);
    users[currentUser].dietHistory = dietHistory;
    localStorage.setItem("users", JSON.stringify(users));
    updateDiet();
  }
}

// ุชุนุฏูู ูุฌุจุฉ
function editMeal(index) {
  let newCalories = prompt("ุฃุฏุฎู ุนุฏุฏ ุงูุณุนุฑุงุช ุงูุฌุฏูุฏ:", dietHistory[index].calories);
  if(newCalories !== null) {
    newCalories = Number(newCalories);
    if(isNaN(newCalories) || newCalories <= 0) return alert("ูููุฉ ุบูุฑ ุตุงูุญุฉ");
    dietHistory[index].calories = newCalories;
    users[currentUser].dietHistory = dietHistory;
    localStorage.setItem("users", JSON.stringify(users));
    updateDiet();
  }
}
