<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Design Marketplace</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- PayPal SDK (PUT YOUR CLIENT ID!) -->
<script src="https://www.paypal.com/sdk/js?client-id=YOUR_CLIENT_ID&currency=USD"></script>

<style>
body {
  margin:0; padding:0;
  font-family:Arial;
  background:#fafafa;
  transition:0.3s;
}
.dark-mode { background:#111; color:white; }

.topbar {
  width:100%;
  background:#000;
  padding:10px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  color:white;
}
.small-icons img { width:30px; margin-left:15px; cursor:pointer; }

.page { display:none; padding:20px; }
.active { display:block; }

/* Horizontal designs scroll */
.designs-container {
  display:flex;
  gap:20px;
  overflow-x:auto;
  padding-bottom:20px;
}
.design-card {
  min-width:250px;
  background:white;
  padding:15px;
  border-radius:10px;
  box-shadow:0 0 10px rgba(0,0,0,0.2);
}
.dark-mode .design-card { background:#222; }

/* Inputs */
input, select, button {
  padding:10px;
  margin:5px 0;
  width:100%;
  border-radius:5px;
  border:1px solid #999;
}
button {
  background:black;
  color:white;
  border:none;
  cursor:pointer;
}
button:hover { opacity:0.8; }

/* Dark mode button */
#darkToggle {
  position:fixed;
  top:20px;
  right:20px;
  background:#333;
  padding:8px 12px;
  border-radius:5px;
  color:white;
  cursor:pointer;
}
</style>
</head>

<body>

<div id="darkToggle">Dark Mode</div>

<div class="topbar">
  <div><b>Design Market</b></div>
  <div class="small-icons">
    <img src="https://cdn-icons-png.flaticon.com/512/25/25694.png" onclick="showPage('home')" title="Home">
    <img src="https://cdn-icons-png.flaticon.com/512/149/149071.png" onclick="showPage('designerCheck')" title="Designer">
    <img src="https://cdn-icons-png.flaticon.com/512/34/34627.png" onclick="showPage('purchases')" title="Purchases">
  </div>
</div>

<!-- HOME PAGE -->
<div id="home" class="page active">
  <h2>Latest Designs</h2>
  <div class="designs-container" id="homeDesigns"></div>
</div>

<!-- DESIGNER CHECK PAGE -->
<div id="designerCheck" class="page">
  <h2>Designer Access</h2>

  <button onclick="gotoRegister()">Register</button>
  <button onclick="gotoLogin()">Login</button>
</div>

<!-- DESIGNER REGISTER -->
<div id="designerRegister" class="page">
  <h2>Create Designer Account</h2>
  <input id="regName" placeholder="First Name">
  <input id="regLast" placeholder="Last Name">
  <input id="regPhone" placeholder="Phone Number">
  <input id="regEmail" placeholder="Email">
  <input id="regPass" placeholder="Password" type="password">

  <button onclick="registerDesigner()">Create Account</button>
</div>

<!-- DESIGNER LOGIN -->
<div id="designerLogin" class="page">
  <h2>Designer Login</h2>
  <input id="loginEmail" placeholder="Email">
  <input id="loginPass" placeholder="Password" type="password">
  <button onclick="loginDesigner()">Login</button>
</div>

<!-- DESIGNER DASHBOARD -->
<div id="designer" class="page">
  <h2>My Dashboard</h2>

  <div>
    <b>Total Buyers:</b> <span id="totalBuyers">0</span>
  </div>

  <h3>Add New Design</h3>
  <input id="designName" placeholder="Design Name">
  <input id="designImg" placeholder="Image URL">
  <input id="designPrice" type="number" placeholder="Price">
  <select id="designCurrency">
    <option value="USD">USD</option>
    <option value="EUR">EUR</option>
    <option value="MAD">MAD</option>
  </select>

  <button onclick="addDesign()">Add Design</button>

  <h3>My Designs</h3>
  <div id="designerDesigns"></div>
</div>

<!-- PURCHASES PAGE -->
<div id="purchases" class="page">
  <h2>My Purchases</h2>
  <div id="purchasesList"></div>
</div>

<script>
let data = JSON.parse(localStorage.getItem("data")) || {
  designers: [],
  logged: null,
  designs: [],
  purchases:[]
};

function save(){ localStorage.setItem("data",JSON.stringify(data)); }

function showPage(p){
  document.querySelectorAll('.page').forEach(pg=>pg.classList.remove('active'));
  document.getElementById(p).classList.add('active');
  refresh();
}

function gotoRegister(){ showPage("designerRegister"); }
function gotoLogin(){ showPage("designerLogin"); }

function registerDesigner(){
  let name=document.getElementById("regName").value;
  let last=document.getElementById("regLast").value;
  let phone=document.getElementById("regPhone").value;
  let email=document.getElementById("regEmail").value;
  let pass=document.getElementById("regPass").value;

  if(!email || !pass){ alert("Email & Password required"); return; }

  data.designers.push({name,last,phone,email,pass});
  save();
  alert("Account created!");
  showPage("designerCheck");
}

function loginDesigner(){
  let email=document.getElementById("loginEmail").value;
  let pass=document.getElementById("loginPass").value;

  let d=data.designers.find(d=>d.email===email && d.pass===pass);
  if(!d){ alert("Wrong login"); return; }

  data.logged=email;
  save();
  showPage("designer");
}

function addDesign(){
  let name=document.getElementById("designName").value;
  let img=document.getElementById("designImg").value;
  let price=document.getElementById("designPrice").value;
  let currency=document.getElementById("designCurrency").value;

  data.designs.push({
    name,img,price,currency,buyers:0,owner:data.logged
  });
  save();
  refresh();
}

function buy(design){
  design.buyers++;
  data.purchases.push({
    name:design.name,
    price:design.price,
    currency:design.currency
  });
  save();
  refresh();
}

/* PAYPAL BUTTON CREATOR */
function createPayPalButton(containerId, design){
  paypal.Buttons({
    createOrder: function(dataPP, actions){
      return actions.order.create({
        purchase_units:[{
          amount:{ value: design.price, currency_code: design.currency },
          description: design.name
        }]
      });
    },
    onApprove: function(dataPP, actions){
      return actions.order.capture().then(function(details){
        alert("Payment successful!");
        buy(design);
      });
    }
  }).render("#"+containerId);
}

function refresh(){
  /* Home Designs */
  let home=document.getElementById("homeDesigns");
  home.innerHTML="";
  data.designs.forEach((d,i)=>{
    home.innerHTML+=`
      <div class="design-card">
        <img src="${d.img}" style="width:100%; border-radius:5px;">
        <h3>${d.name}</h3>
        <b>${d.price} ${d.currency}</b><br>
        Buyers: ${d.buyers}<br>
        <div id="paypal-home-${i}"></div>
      </div>
    `;
  });

  data.designs.forEach((d,i)=> createPayPalButton(`paypal-home-${i}`, d));

  /* Designer Dashboard */
  if(data.logged){
    let myD = data.designs.filter(x=>x.owner===data.logged);
    document.getElementById("designerDesigns").innerHTML="";

    let total = myD.reduce((a,b)=>a+Number(b.buyers),0);
    document.getElementById("totalBuyers").innerText = total;

    myD.forEach((d,i)=>{
      document.getElementById("designerDesigns").innerHTML += `
        <div class="design-card">
          <img src="${d.img}" style="width:100%; border-radius:5px;">
          <h3>${d.name}</h3>
          <b>${d.price} ${d.currency}</b><br>
          Buyers: ${d.buyers}<br>
        </div>`;
    });
  }

  /* Purchases Page */
  let pur=document.getElementById("purchasesList");
  pur.innerHTML="";
  data.purchases.forEach(p=>{
    pur.innerHTML+=`
      <div class="design-card">
        <h3>${p.name}</h3>
        ${p.price} ${p.currency}
      </div>`;
  });
}

/* DARK MODE */
document.getElementById("darkToggle").onclick=function(){
  document.body.classList.toggle("dark-mode");
};

refresh();
</script>

</body>
</html>
